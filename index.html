<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>NERPLO Risk Manager</title>

  <link rel="stylesheet" href="assets/css/styles.css">

  <style>
    .mode-switch {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }

    .mode-btn {
      flex: 1;
      padding: 8px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: transparent;
      color: #d1d5db;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .mode-btn.active {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #052e16;
      font-weight: bold;
    }
  </style>
</head>

<body>

<div class="app">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div>
      <div class="brand-title">NERPLO</div>
      <div class="brand-sub">Painel de Gest√£o de Risco</div>
    </div>

    <div class="nav-section-title">Ferramentas</div>

    <nav class="nav">
      <button class="nav-btn active" data-tool="tool-banca">
        üßÆ Simulador de Banca
      </button>

      <button class="nav-btn" data-tool="tool-posicao">
        üìè Calculadora de Posi√ß√£o
      </button>
    </nav>

    <div class="sidebar-footer">v0.4 ‚Ä¢ NERPLO</div>
  </aside>


  <!-- MAIN -->
  <main class="main">

    <!-- ==================== TOOL A ==================== -->
    <section id="tool-banca" class="card">

      <h1 class="main-title">Simulador de Sobreviv√™ncia da Banca</h1>
      <p class="main-subtitle">
        Veja como sua banca se comporta ao longo dos trades.
      </p>

      <div class="fields-row">

        <div class="field">
          <label>Banca inicial (US$)</label>
          <input id="bank" type="number" value="100">
        </div>

        <div class="field">
          <label>Risco por trade (%)</label>
          <input id="riskPct" type="number" value="2">
        </div>

        <div class="field">
          <label>Taxa de acerto (%)</label>
          <input id="winRate" type="number" value="50">
        </div>

        <div class="field">
          <label>R:R</label>
          <input id="rr" type="number" value="2">
        </div>

        <div class="field">
          <label>N¬∫ de trades</label>
          <input id="numTrades" type="number" value="50">
        </div>

      </div>

      <button id="simulateBtn" class="btn-primary">Simular estrat√©gia</button>
      <div id="simError" class="error"></div>

      <div id="simResults" class="results">

        <div class="results-row">
          <div class="result-card">
            <div class="result-item-label">Ganho por trade vencedor</div>
            <div id="winPerTrade" class="result-item-value">‚Äî</div>
          </div>

          <div class="result-card">
            <div class="result-item-label">Perda por trade perdedor</div>
            <div id="lossPerTrade" class="result-item-value">‚Äî</div>
          </div>
        </div>

        <div class="results-row">
          <div class="result-card">
            <div id="labelExpected" class="result-item-label"></div>
            <div id="expectedBank" class="result-item-value">‚Äî</div>
          </div>

          <div class="result-card">
            <div id="labelAllWins" class="result-item-label"></div>
            <div id="bankAllWins" class="result-item-value">‚Äî</div>
          </div>

          <div class="result-card">
            <div id="labelAllLosses" class="result-item-label"></div>
            <div id="bankAllLosses" class="result-item-value">‚Äî</div>
          </div>
        </div>

        <div id="expBadge" class="badge"></div>

      </div>

    </section>


    <!-- ==================== TOOL B ==================== -->
    <section id="tool-posicao" class="card" style="display:none;">

      <h1 class="main-title">Calculadora de Tamanho da Posi√ß√£o</h1>
      <p class="main-subtitle">
        Calcule o tamanho correto do trade com base no risco que deseja assumir.
      </p>

      <div class="mode-switch">
        <button id="mode1Btn" class="mode-btn active" type="button">
          Modo 1: Risco + Stop %
        </button>
        <button id="mode2Btn" class="mode-btn" type="button">
          Modo 2: Risco + Entrada + Stop
        </button>
      </div>

      <div class="fields-row">

        <div class="field">
          <label>Risco por trade (US$)</label>
          <input id="risk" type="number" value="40">
        </div>

        <div class="field">
          <label>Alavancagem (x)</label>
          <input id="leverage" type="number" value="1">
        </div>
      </div>

      <!-- MODO 1 -->
      <div id="mode1Fields" class="fields-row">
        <div class="field">
          <label>Stop Loss (%)</label>
          <input id="stopPercent" type="number" placeholder="Ex: 2">
        </div>
      </div>

      <!-- MODO 2 -->
      <div id="mode2Fields" class="fields-row" style="display:none;">
        <div class="field">
          <label>Pre√ßo de entrada</label>
          <input id="entryPrice" type="number" placeholder="Ex: 90000">
        </div>

        <div class="field">
          <label>Pre√ßo do stop</label>
          <input id="stopPrice" type="number" placeholder="Ex: 89000">
        </div>
      </div>

      <button id="calcBtn" class="btn-primary">Calcular posi√ß√£o</button>
      <div id="error" class="error"></div>

      <div id="result" class="results">

        <div class="results-row">
          <div class="result-card">
            <div class="result-item-label">Stop (%)</div>
            <div id="stopValue" class="result-item-value">‚Äî</div>
          </div>

          <div class="result-card">
            <div class="result-item-label">Tamanho da posi√ß√£o (US$)</div>
            <div id="posValue" class="result-item-value">‚Äî</div>
          </div>

          <div class="result-card">
            <div class="result-item-label">Margem necess√°ria</div>
            <div id="marginValue" class="result-item-value">‚Äî</div>
          </div>
        </div>

      </div>

    </section>

  </main>
</div>


<!-- ==================== JAVASCRIPT ==================== -->
<script>

document.addEventListener("DOMContentLoaded", () => {

/* ===== MENU ===== */
const navButtons = document.querySelectorAll(".nav-btn[data-tool]");
const tools = {
  "tool-banca": document.getElementById("tool-banca"),
  "tool-posicao": document.getElementById("tool-posicao")
};

navButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const tool = btn.dataset.tool;

    navButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");

    Object.keys(tools).forEach(key => {
      tools[key].style.display = (key === tool) ? "block" : "none";
    });
  });
});

/* ===== FORMATA√á√ÉO ===== */
const formatMoney = (v) => "US$ " + v.toLocaleString("en-US",{minimumFractionDigits:2});
const formatPercent = (v) => v.toFixed(2) + "%";

/* ===== TOOL A ===== */
document.getElementById("simulateBtn").addEventListener("click", () => {

  const bank = parseFloat(bank.value);
  const riskPct = parseFloat(riskPct.value);
  const winRate = parseFloat(winRate.value);
  const rr = parseFloat(rr.value);
  const N = parseInt(numTrades.value);

  const errorBox = document.getElementById("simError");
  const resultsBox = document.getElementById("simResults");
  const expBadge = document.getElementById("expBadge");

  errorBox.style.display = "none";
  resultsBox.style.display = "none";

  if (!bank || !riskPct || !rr || !N) {
    errorBox.innerText = "Preencha todos os campos";
    errorBox.style.display = "block";
    return;
  }

  const riskDecimal = riskPct / 100;
  const riskAmount = bank * riskDecimal;
  const winAmount = riskAmount * rr;

  const p = winRate / 100;
  const expectancy = (p * rr) - (1 - p);
  const growth = 1 + (expectancy * riskDecimal);

  const expected = bank * Math.pow(growth, N);
  const allWins = bank * Math.pow(1 + (riskDecimal * rr), N);
  const allLosses = bank * Math.pow(1 - riskDecimal, N);

  labelExpected.innerText = `Banca esperada ap√≥s ${N} trades`;
  labelAllWins.innerText = `Banca se TODOS os ${N} trades forem vencedores`;
  labelAllLosses.innerText = `Banca se TODOS os ${N} trades forem perdedores`;

  winPerTrade.innerText = formatMoney(winAmount);
  lossPerTrade.innerText = formatMoney(riskAmount);
  expectedBank.innerText = formatMoney(expected);
  bankAllWins.innerText = formatMoney(allWins);
  bankAllLosses.innerText = formatMoney(allLosses);

  expBadge.innerText = expectancy > 0
    ? "Estrat√©gia com expectativa POSITIVA"
    : "Estrat√©gia com expectativa NEGATIVA ou NEUTRA";

  resultsBox.style.display = "block";
});



/* ===== TOOL B ===== */
let currentMode = "mode1";

mode1Btn.addEventListener("click", () => setMode("mode1"));
mode2Btn.addEventListener("click", () => setMode("mode2"));

function setMode(mode) {
  currentMode = mode;
  mode1Fields.style.display = (mode === "mode1") ? "flex" : "none";
  mode2Fields.style.display = (mode === "mode2") ? "flex" : "none";

  mode1Btn.classList.toggle("active", mode === "mode1");
  mode2Btn.classList.toggle("active", mode === "mode2");

  result.style.display = "none";
  error.style.display = "none";
}

calcBtn.addEventListener("click", () => {

  const risk = parseFloat(risk.value);
  const leverageVal = parseFloat(leverage.value) || 1;

  error.style.display = "none";
  result.style.display = "none";

  let stopPercent;

  if (currentMode === "mode1") {
    stopPercent = parseFloat(stopPercent.value);
    if (!stopPercent) {
      error.innerText = "Informe o Stop (%)";
      error.style.display = "block";
      return;
    }

  } else {
    const entry = parseFloat(entryPrice.value);
    const stop = parseFloat(stopPrice.value);

    if (!entry || !stop) {
      error.innerText = "Informe entrada e stop";
      error.style.display = "block";
      return;
    }

    stopPercent = Math.abs(entry - stop) / entry * 100;
  }

  const positionSize = risk / (stopPercent / 100);
  const margin = positionSize / leverageVal;

  stopValue.innerText = formatPercent(stopPercent);
  posValue.innerText = formatMoney(positionSize);
  marginValue.innerText = formatMoney(margin);

  result.style.display = "block";

});

});
</script>
</body>
</html>
